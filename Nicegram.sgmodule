#!name=Nicegram 去广告
#!desc=移除消息流和置顶广告，拦截 ATT 活动上报 (Surge版本)
#!system=mac

[Rule]
# 拦截广告相关域名
DOMAIN-KEYWORD,nicegram.github.io,REJECT
DOMAIN-SUFFIX,adsgram.me,REJECT
DOMAIN-SUFFIX,adsgram.ai,REJECT  
DOMAIN-SUFFIX,app-analytics-services.com,REJECT
# 拦截ATT用户行为上报
URL-REGEX,^https://nicegram\.cloud/api/v7/att/user-action.*,REJECT

[URL Rewrite]
# 清空广告列表
^https://nicegram\.cloud/api/v7/att/scroll-to-earn/ads-list(\?.*)?$ - reject

[Script]
# 修改用户信息，解锁订阅功能
nicegram_userinfo = type=http-response,pattern=^https://nicegram\.cloud/api/v7/user/info,requires-body=1,max-size=0,script-path=data:text/plain;base64,LyoqCiAqIE5pY2VncmFt55So5oi35L+h5oGv6Kej6ZSB6ISa5pysIC0gU3VyZ2XniYjmnKwKICog6Kej6ZSBUGx1c+iuouWIheWKn+iDvQogKi8KCmxldCBib2R5ID0gJHJlc3BvbnNlLmJvZHk7CmxldCBvYmogPSBKU09OLnBhcnNlKGJvZHkpOwoKaWYgKG9iai5kYXRhICYmIG9iai5kYXRhLnVzZXIpIHsKICAgIG9iai5kYXRhLnVzZXIuc3Vic2NyaXB0aW9uUGx1cyA9IHRydWU7CiAgICBvYmouZGF0YS51c2VyLnN0b3JlX3N1YnNjcmlwdGlvbiA9IHRydWU7CiAgICBvYmouZGF0YS51c2VyLnN1YnNjcmlwdGlvbiA9IHRydWU7CiAgICBvYmouZGF0YS51c2VyLmxpZmV0aW1lX3N1YnNjcmlwdGlvbiA9IHRydWU7Cn0KCiRkb25lKHtib2R5OiBKU09OLnN0cmluZ2lmeShvYmopfSk7

# 修改ATT积分
nicegram_attinfo = type=http-response,pattern=^https://nicegram\.cloud/api/v7/att/scroll-to-earn/user-info,requires-body=1,max-size=0,script-path=data:text/plain;base64,LyoqCiAqIE5pY2VncmFtIEFUVOepr+WIhuS/ruaUueiEmuacrCAtIFN1cmdl54mI5pysQogKICog5L+u5pS5QVRUeei3r+WIhuS4ujg4ODg4ODg4OAogKi8KCmxldCBib2R5ID0gJHJlc3BvbnNlLmJvZHk7CmxldCBvYmogPSBKU09OLnBhcnNlKGJvZHkpOwoKaWYgKG9iai5kYXRhKSB7CiAgICBvYmouZGF0YS5hdHRQb2ludHMgPSA4ODg4ODg4ODg7Cn0KCiRkb25lKHtib2R5OiBKU09OLnN0cmluZ2lmeShvYmopfSk7

# 清空广告列表  
nicegram_adslist = type=http-response,pattern=^https://nicegram\.cloud/api/v7/att/scroll-to-earn/ads-list,requires-body=1,max-size=0,script-path=data:text/plain;base64,LyoqCiAqIE5pY2VncmFt5bm/5ZGK5YiX6KGo5riF56m66ISa5pysIC0gU3VyZ2XniYjmnKwKICog5riF56m65bm/5ZGK5YiX6KGoQggKICovCgpsZXQgYm9keSA9ICRyZXNwb25zZS5ib2R5OwpsZXQgb2JqID0gSlNPTi5wYXJzZShib2R5KTsKCmlmIChvYmouZGF0YSkgewogICAgb2JqLmRhdGEgPSBbXTsKfQoKJGRvbmUoe2JvZHk6IEpTT04uc3RyaW5naWZ5KG9iail9KTs=

[MITM]
hostname = %APPEND% nicegram.cloud
