<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元气壁纸 ForwardWidget 演示</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .demo-header h1 {
            font-size: 36px;
            margin: 0;
            margin-bottom: 10px;
        }

        .demo-header p {
            font-size: 18px;
            opacity: 0.9;
            margin: 0;
        }

        .demo-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .demo-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .demo-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .demo-section h3 {
            margin-top: 0;
            color: #FFE894;
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .wallpaper-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .wallpaper-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .wallpaper-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .wallpaper-info {
            padding: 15px;
            color: #333;
        }

        .wallpaper-title {
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .wallpaper-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .wallpaper-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            flex: 1;
        }

        .action-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .status-display {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #E0E0E0;
            max-height: 200px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 16px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #51cf66;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .demo-header h1 {
                font-size: 28px;
            }
            
            .demo-header p {
                font-size: 16px;
            }
            
            .demo-controls {
                padding: 15px;
            }
            
            .demo-btn {
                display: block;
                width: 100%;
                margin: 8px 0;
            }
            
            .wallpaper-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>🎨 元气壁纸 ForwardWidget</h1>
        <p>ForwardWidget标准格式演示 - 支持随机获取、分类浏览、关键词搜索</p>
    </div>

    <div class="demo-controls">
        <h3 style="color: white; margin-top: 0;">🛠️ 功能演示</h3>
        <button class="demo-btn" onclick="testRandomWallpapers()">🎲 测试随机壁纸</button>
        <button class="demo-btn" onclick="testCategoryWallpapers()">📂 测试分类壁纸</button>
        <button class="demo-btn" onclick="testSearchWallpapers()">🔍 测试搜索壁纸</button>
        <button class="demo-btn" onclick="showWidgetMetadata()">📋 查看组件信息</button>
        <button class="demo-btn" onclick="clearResults()">🗑️ 清空结果</button>
    </div>

    <div id="random-section" class="demo-section">
        <h3>🎲 随机壁纸模块</h3>
        <p>获取随机推荐的高质量壁纸，支持6/12/18/24张选择</p>
        <div id="random-results">
            <div class="loading">点击"测试随机壁纸"开始演示</div>
        </div>
    </div>

    <div id="category-section" class="demo-section">
        <h3>📂 分类壁纸模块</h3>
        <p>根据分类获取专题壁纸，支持8大分类：4K超清、风景自然、动漫二次元等</p>
        <div id="category-results">
            <div class="loading">点击"测试分类壁纸"开始演示</div>
        </div>
    </div>

    <div id="search-section" class="demo-section">
        <h3>🔍 搜索壁纸模块</h3>
        <p>根据关键词搜索相关壁纸，智能匹配分类和内容</p>
        <div id="search-results">
            <div class="loading">点击"测试搜索壁纸"开始演示</div>
        </div>
    </div>

    <div class="demo-section">
        <h3>📊 状态信息</h3>
        <div id="status-info" class="status-display">
            等待测试开始...
        </div>
    </div>

    <!-- 引入ForwardWidget脚本 -->
    <script src="yuanqi-wallpaper-widget.js"></script>

    <script>
        let statusElement = document.getElementById('status-info');

        // 更新状态显示
        function updateStatus(message) {
            const timestamp = new Date().toLocaleTimeString();
            statusElement.innerHTML += `[${timestamp}] ${message}\n`;
            statusElement.scrollTop = statusElement.scrollHeight;
        }

        // 显示壁纸结果
        function displayWallpapers(wallpapers, containerId) {
            const container = document.getElementById(containerId);
            
            if (!wallpapers || wallpapers.length === 0) {
                container.innerHTML = '<div class="error">❌ 没有获取到壁纸数据</div>';
                return;
            }

            // 检查是否是错误信息
            if (wallpapers[0].type === 'error') {
                container.innerHTML = `<div class="error">❌ ${wallpapers[0].title}: ${wallpapers[0].description}</div>`;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'wallpaper-grid';

            wallpapers.forEach(wallpaper => {
                const item = document.createElement('div');
                item.className = 'wallpaper-item';
                
                const imageUrl = wallpaper.coverUrl || wallpaper.imageUrl || wallpaper.videoUrl;
                const isVideo = wallpaper.type === 'video';
                
                item.innerHTML = `
                    ${isVideo ? 
                        `<video class="wallpaper-image" poster="${wallpaper.coverUrl}" controls muted>
                             <source src="${wallpaper.videoUrl}" type="video/mp4">
                         </video>` :
                        `<img src="${imageUrl}" alt="${wallpaper.title}" class="wallpaper-image" 
                              onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"100\\" height=\\"100\\"><text y=\\"50\\" font-size=\\"14\\" fill=\\"%23999\\">加载失败</text></svg>'">`
                    }
                    <div class="wallpaper-info">
                        <h4 class="wallpaper-title">${wallpaper.title}</h4>
                        <div class="wallpaper-meta">
                            ID: ${wallpaper.id} | 类型: ${wallpaper.type} | 来源: ${wallpaper.source || '元气壁纸'}
                        </div>
                        <div class="wallpaper-actions">
                            <button class="action-btn" onclick="downloadWallpaper('${imageUrl}', '${wallpaper.title}')">💾 下载</button>
                            <button class="action-btn" onclick="previewWallpaper('${imageUrl}', '${wallpaper.title}')">👁️ 预览</button>
                            ${wallpaper.detailUrl ? 
                                `<button class="action-btn" onclick="window.open('${wallpaper.detailUrl}', '_blank')">🔗 详情</button>` : 
                                ''
                            }
                        </div>
                    </div>
                `;
                grid.appendChild(item);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        // 测试随机壁纸
        async function testRandomWallpapers() {
            updateStatus("🎲 开始测试随机壁纸功能...");
            document.getElementById('random-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>正在获取随机壁纸...</div>';
            
            try {
                // 测试不同数量参数
                const params = { count: "12" };
                const wallpapers = await getRandomWallpapers(params);
                
                updateStatus(`✅ 随机壁纸获取成功，共 ${wallpapers.length} 张`);
                displayWallpapers(wallpapers, 'random-results');
                
            } catch (error) {
                updateStatus(`❌ 随机壁纸测试失败: ${error.message}`);
                document.getElementById('random-results').innerHTML = `<div class="error">❌ 测试失败: ${error.message}</div>`;
            }
        }

        // 测试分类壁纸
        async function testCategoryWallpapers() {
            updateStatus("📂 开始测试分类壁纸功能...");
            document.getElementById('category-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>正在获取分类壁纸...</div>';
            
            try {
                // 测试风景分类
                const params = { category: "2", count: "6" };
                const wallpapers = await getCategoryWallpapers(params);
                
                updateStatus(`✅ 分类壁纸获取成功，共 ${wallpapers.length} 张`);
                displayWallpapers(wallpapers, 'category-results');
                
            } catch (error) {
                updateStatus(`❌ 分类壁纸测试失败: ${error.message}`);
                document.getElementById('category-results').innerHTML = `<div class="error">❌ 测试失败: ${error.message}</div>`;
            }
        }

        // 测试搜索壁纸
        async function testSearchWallpapers() {
            updateStatus("🔍 开始测试搜索壁纸功能...");
            document.getElementById('search-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>正在搜索壁纸...</div>';
            
            try {
                // 测试风景搜索
                const params = { keyword: "风景", count: "6" };
                const wallpapers = await searchWallpapers(params);
                
                updateStatus(`✅ 搜索壁纸获取成功，共 ${wallpapers.length} 张`);
                displayWallpapers(wallpapers, 'search-results');
                
            } catch (error) {
                updateStatus(`❌ 搜索壁纸测试失败: ${error.message}`);
                document.getElementById('search-results').innerHTML = `<div class="error">❌ 测试失败: ${error.message}</div>`;
            }
        }

        // 显示组件元数据
        function showWidgetMetadata() {
            updateStatus("📋 显示组件元数据信息...");
            
            if (typeof WidgetMetadata !== 'undefined') {
                updateStatus("📊 组件信息:");
                updateStatus(`   ID: ${WidgetMetadata.id}`);
                updateStatus(`   标题: ${WidgetMetadata.title}`);
                updateStatus(`   版本: ${WidgetMetadata.version}`);
                updateStatus(`   作者: ${WidgetMetadata.author}`);
                updateStatus(`   网站: ${WidgetMetadata.site}`);
                updateStatus(`   模块数量: ${WidgetMetadata.modules.length}`);
                
                WidgetMetadata.modules.forEach((module, index) => {
                    updateStatus(`   模块${index + 1}: ${module.title} (${module.name})`);
                    updateStatus(`     函数: ${module.functionName}`);
                    updateStatus(`     参数数量: ${module.params.length}`);
                });
                
                updateStatus("✅ 组件元数据显示完成");
            } else {
                updateStatus("❌ 未找到WidgetMetadata对象");
            }
        }

        // 清空所有结果
        function clearResults() {
            document.getElementById('random-results').innerHTML = '<div class="loading">点击"测试随机壁纸"开始演示</div>';
            document.getElementById('category-results').innerHTML = '<div class="loading">点击"测试分类壁纸"开始演示</div>';
            document.getElementById('search-results').innerHTML = '<div class="loading">点击"测试搜索壁纸"开始演示</div>';
            statusElement.innerHTML = '已清空所有结果...\n';
            updateStatus("🗑️ 所有结果已清空");
        }

        // 下载壁纸
        function downloadWallpaper(imageUrl, title) {
            try {
                const link = document.createElement('a');
                link.href = imageUrl;
                link.download = `${title.replace(/[^\w\s-]/g, '')}.jpg`;
                link.target = '_blank';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateStatus(`💾 开始下载: ${title}`);
            } catch (error) {
                updateStatus(`❌ 下载失败: ${error.message}`);
            }
        }

        // 预览壁纸
        function previewWallpaper(imageUrl, title) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%; position: relative;">
                    <img src="${imageUrl}" alt="${title}" style="max-width: 100%; max-height: 100%; border-radius: 10px;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: -10px; right: -10px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px;">×</button>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
            updateStatus(`👁️ 预览: ${title}`);
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus("🎨 元气壁纸 ForwardWidget 演示页面已加载");
            updateStatus("💡 这是符合ForwardWidget标准格式的脚本演示");
            updateStatus("📱 支持导入到ForwardWidget应用中使用");
            updateStatus("🛠️ 点击上方按钮测试各项功能");
            
            // 显示组件信息
            if (typeof WidgetMetadata !== 'undefined') {
                updateStatus(`✅ 组件已加载: ${WidgetMetadata.title} v${WidgetMetadata.version}`);
            } else {
                updateStatus("❌ 警告: 未检测到WidgetMetadata对象");
            }
        });

        // 键盘快捷键
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey || event.metaKey) {
                switch (event.key) {
                    case '1':
                        event.preventDefault();
                        testRandomWallpapers();
                        break;
                    case '2':
                        event.preventDefault();
                        testCategoryWallpapers();
                        break;
                    case '3':
                        event.preventDefault();
                        testSearchWallpapers();
                        break;
                    case 'i':
                        event.preventDefault();
                        showWidgetMetadata();
                        break;
                }
            }
        });

        // 显示快捷键提示
        setTimeout(() => {
            updateStatus("⌨️ 快捷键提示:");
            updateStatus("   Ctrl+1: 测试随机壁纸");
            updateStatus("   Ctrl+2: 测试分类壁纸");
            updateStatus("   Ctrl+3: 测试搜索壁纸");
            updateStatus("   Ctrl+I: 查看组件信息");
        }, 1000);
    </script>
</body>
</html>