<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ƒæ°”å£çº¸ ForwardWidget æ¼”ç¤º</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .demo-header h1 {
            font-size: 36px;
            margin: 0;
            margin-bottom: 10px;
        }

        .demo-header p {
            font-size: 18px;
            opacity: 0.9;
            margin: 0;
        }

        .demo-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .demo-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .demo-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .demo-section h3 {
            margin-top: 0;
            color: #FFE894;
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .wallpaper-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .wallpaper-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .wallpaper-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .wallpaper-info {
            padding: 15px;
            color: #333;
        }

        .wallpaper-title {
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .wallpaper-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .wallpaper-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            flex: 1;
        }

        .action-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .status-display {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #E0E0E0;
            max-height: 200px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 16px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #51cf66;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .demo-header h1 {
                font-size: 28px;
            }
            
            .demo-header p {
                font-size: 16px;
            }
            
            .demo-controls {
                padding: 15px;
            }
            
            .demo-btn {
                display: block;
                width: 100%;
                margin: 8px 0;
            }
            
            .wallpaper-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>ğŸ¨ å…ƒæ°”å£çº¸ ForwardWidget</h1>
        <p>ForwardWidgetæ ‡å‡†æ ¼å¼æ¼”ç¤º - æ”¯æŒéšæœºè·å–ã€åˆ†ç±»æµè§ˆã€å…³é”®è¯æœç´¢</p>
    </div>

    <div class="demo-controls">
        <h3 style="color: white; margin-top: 0;">ğŸ› ï¸ åŠŸèƒ½æ¼”ç¤º</h3>
        <button class="demo-btn" onclick="testRandomWallpapers()">ğŸ² æµ‹è¯•éšæœºå£çº¸</button>
        <button class="demo-btn" onclick="testCategoryWallpapers()">ğŸ“‚ æµ‹è¯•åˆ†ç±»å£çº¸</button>
        <button class="demo-btn" onclick="testSearchWallpapers()">ğŸ” æµ‹è¯•æœç´¢å£çº¸</button>
        <button class="demo-btn" onclick="showWidgetMetadata()">ğŸ“‹ æŸ¥çœ‹ç»„ä»¶ä¿¡æ¯</button>
        <button class="demo-btn" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
    </div>

    <div id="random-section" class="demo-section">
        <h3>ğŸ² éšæœºå£çº¸æ¨¡å—</h3>
        <p>è·å–éšæœºæ¨èçš„é«˜è´¨é‡å£çº¸ï¼Œæ”¯æŒ6/12/18/24å¼ é€‰æ‹©</p>
        <div id="random-results">
            <div class="loading">ç‚¹å‡»"æµ‹è¯•éšæœºå£çº¸"å¼€å§‹æ¼”ç¤º</div>
        </div>
    </div>

    <div id="category-section" class="demo-section">
        <h3>ğŸ“‚ åˆ†ç±»å£çº¸æ¨¡å—</h3>
        <p>æ ¹æ®åˆ†ç±»è·å–ä¸“é¢˜å£çº¸ï¼Œæ”¯æŒ8å¤§åˆ†ç±»ï¼š4Kè¶…æ¸…ã€é£æ™¯è‡ªç„¶ã€åŠ¨æ¼«äºŒæ¬¡å…ƒç­‰</p>
        <div id="category-results">
            <div class="loading">ç‚¹å‡»"æµ‹è¯•åˆ†ç±»å£çº¸"å¼€å§‹æ¼”ç¤º</div>
        </div>
    </div>

    <div id="search-section" class="demo-section">
        <h3>ğŸ” æœç´¢å£çº¸æ¨¡å—</h3>
        <p>æ ¹æ®å…³é”®è¯æœç´¢ç›¸å…³å£çº¸ï¼Œæ™ºèƒ½åŒ¹é…åˆ†ç±»å’Œå†…å®¹</p>
        <div id="search-results">
            <div class="loading">ç‚¹å‡»"æµ‹è¯•æœç´¢å£çº¸"å¼€å§‹æ¼”ç¤º</div>
        </div>
    </div>

    <div class="demo-section">
        <h3>ğŸ“Š çŠ¶æ€ä¿¡æ¯</h3>
        <div id="status-info" class="status-display">
            ç­‰å¾…æµ‹è¯•å¼€å§‹...
        </div>
    </div>

    <!-- å¼•å…¥ForwardWidgetè„šæœ¬ -->
    <script src="yuanqi-wallpaper-widget.js"></script>

    <script>
        let statusElement = document.getElementById('status-info');

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message) {
            const timestamp = new Date().toLocaleTimeString();
            statusElement.innerHTML += `[${timestamp}] ${message}\n`;
            statusElement.scrollTop = statusElement.scrollHeight;
        }

        // æ˜¾ç¤ºå£çº¸ç»“æœ
        function displayWallpapers(wallpapers, containerId) {
            const container = document.getElementById(containerId);
            
            if (!wallpapers || wallpapers.length === 0) {
                container.innerHTML = '<div class="error">âŒ æ²¡æœ‰è·å–åˆ°å£çº¸æ•°æ®</div>';
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æ˜¯é”™è¯¯ä¿¡æ¯
            if (wallpapers[0].type === 'error') {
                container.innerHTML = `<div class="error">âŒ ${wallpapers[0].title}: ${wallpapers[0].description}</div>`;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'wallpaper-grid';

            wallpapers.forEach(wallpaper => {
                const item = document.createElement('div');
                item.className = 'wallpaper-item';
                
                const imageUrl = wallpaper.coverUrl || wallpaper.imageUrl || wallpaper.videoUrl;
                const isVideo = wallpaper.type === 'video';
                
                item.innerHTML = `
                    ${isVideo ? 
                        `<video class="wallpaper-image" poster="${wallpaper.coverUrl}" controls muted>
                             <source src="${wallpaper.videoUrl}" type="video/mp4">
                         </video>` :
                        `<img src="${imageUrl}" alt="${wallpaper.title}" class="wallpaper-image" 
                              onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" width=\\"100\\" height=\\"100\\"><text y=\\"50\\" font-size=\\"14\\" fill=\\"%23999\\">åŠ è½½å¤±è´¥</text></svg>'">`
                    }
                    <div class="wallpaper-info">
                        <h4 class="wallpaper-title">${wallpaper.title}</h4>
                        <div class="wallpaper-meta">
                            ID: ${wallpaper.id} | ç±»å‹: ${wallpaper.type} | æ¥æº: ${wallpaper.source || 'å…ƒæ°”å£çº¸'}
                        </div>
                        <div class="wallpaper-actions">
                            <button class="action-btn" onclick="downloadWallpaper('${imageUrl}', '${wallpaper.title}')">ğŸ’¾ ä¸‹è½½</button>
                            <button class="action-btn" onclick="previewWallpaper('${imageUrl}', '${wallpaper.title}')">ğŸ‘ï¸ é¢„è§ˆ</button>
                            ${wallpaper.detailUrl ? 
                                `<button class="action-btn" onclick="window.open('${wallpaper.detailUrl}', '_blank')">ğŸ”— è¯¦æƒ…</button>` : 
                                ''
                            }
                        </div>
                    </div>
                `;
                grid.appendChild(item);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        // æµ‹è¯•éšæœºå£çº¸
        async function testRandomWallpapers() {
            updateStatus("ğŸ² å¼€å§‹æµ‹è¯•éšæœºå£çº¸åŠŸèƒ½...");
            document.getElementById('random-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>æ­£åœ¨è·å–éšæœºå£çº¸...</div>';
            
            try {
                // æµ‹è¯•ä¸åŒæ•°é‡å‚æ•°
                const params = { count: "12" };
                const wallpapers = await getRandomWallpapers(params);
                
                updateStatus(`âœ… éšæœºå£çº¸è·å–æˆåŠŸï¼Œå…± ${wallpapers.length} å¼ `);
                displayWallpapers(wallpapers, 'random-results');
                
            } catch (error) {
                updateStatus(`âŒ éšæœºå£çº¸æµ‹è¯•å¤±è´¥: ${error.message}`);
                document.getElementById('random-results').innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•åˆ†ç±»å£çº¸
        async function testCategoryWallpapers() {
            updateStatus("ğŸ“‚ å¼€å§‹æµ‹è¯•åˆ†ç±»å£çº¸åŠŸèƒ½...");
            document.getElementById('category-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>æ­£åœ¨è·å–åˆ†ç±»å£çº¸...</div>';
            
            try {
                // æµ‹è¯•é£æ™¯åˆ†ç±»
                const params = { category: "2", count: "6" };
                const wallpapers = await getCategoryWallpapers(params);
                
                updateStatus(`âœ… åˆ†ç±»å£çº¸è·å–æˆåŠŸï¼Œå…± ${wallpapers.length} å¼ `);
                displayWallpapers(wallpapers, 'category-results');
                
            } catch (error) {
                updateStatus(`âŒ åˆ†ç±»å£çº¸æµ‹è¯•å¤±è´¥: ${error.message}`);
                document.getElementById('category-results').innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•æœç´¢å£çº¸
        async function testSearchWallpapers() {
            updateStatus("ğŸ” å¼€å§‹æµ‹è¯•æœç´¢å£çº¸åŠŸèƒ½...");
            document.getElementById('search-results').innerHTML = '<div class="loading"><div class="loading-spinner"></div>æ­£åœ¨æœç´¢å£çº¸...</div>';
            
            try {
                // æµ‹è¯•é£æ™¯æœç´¢
                const params = { keyword: "é£æ™¯", count: "6" };
                const wallpapers = await searchWallpapers(params);
                
                updateStatus(`âœ… æœç´¢å£çº¸è·å–æˆåŠŸï¼Œå…± ${wallpapers.length} å¼ `);
                displayWallpapers(wallpapers, 'search-results');
                
            } catch (error) {
                updateStatus(`âŒ æœç´¢å£çº¸æµ‹è¯•å¤±è´¥: ${error.message}`);
                document.getElementById('search-results').innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºç»„ä»¶å…ƒæ•°æ®
        function showWidgetMetadata() {
            updateStatus("ğŸ“‹ æ˜¾ç¤ºç»„ä»¶å…ƒæ•°æ®ä¿¡æ¯...");
            
            if (typeof WidgetMetadata !== 'undefined') {
                updateStatus("ğŸ“Š ç»„ä»¶ä¿¡æ¯:");
                updateStatus(`   ID: ${WidgetMetadata.id}`);
                updateStatus(`   æ ‡é¢˜: ${WidgetMetadata.title}`);
                updateStatus(`   ç‰ˆæœ¬: ${WidgetMetadata.version}`);
                updateStatus(`   ä½œè€…: ${WidgetMetadata.author}`);
                updateStatus(`   ç½‘ç«™: ${WidgetMetadata.site}`);
                updateStatus(`   æ¨¡å—æ•°é‡: ${WidgetMetadata.modules.length}`);
                
                WidgetMetadata.modules.forEach((module, index) => {
                    updateStatus(`   æ¨¡å—${index + 1}: ${module.title} (${module.name})`);
                    updateStatus(`     å‡½æ•°: ${module.functionName}`);
                    updateStatus(`     å‚æ•°æ•°é‡: ${module.params.length}`);
                });
                
                updateStatus("âœ… ç»„ä»¶å…ƒæ•°æ®æ˜¾ç¤ºå®Œæˆ");
            } else {
                updateStatus("âŒ æœªæ‰¾åˆ°WidgetMetadataå¯¹è±¡");
            }
        }

        // æ¸…ç©ºæ‰€æœ‰ç»“æœ
        function clearResults() {
            document.getElementById('random-results').innerHTML = '<div class="loading">ç‚¹å‡»"æµ‹è¯•éšæœºå£çº¸"å¼€å§‹æ¼”ç¤º</div>';
            document.getElementById('category-results').innerHTML = '<div class="loading">ç‚¹å‡»"æµ‹è¯•åˆ†ç±»å£çº¸"å¼€å§‹æ¼”ç¤º</div>';
            document.getElementById('search-results').innerHTML = '<div class="loading">ç‚¹å‡»"æµ‹è¯•æœç´¢å£çº¸"å¼€å§‹æ¼”ç¤º</div>';
            statusElement.innerHTML = 'å·²æ¸…ç©ºæ‰€æœ‰ç»“æœ...\n';
            updateStatus("ğŸ—‘ï¸ æ‰€æœ‰ç»“æœå·²æ¸…ç©º");
        }

        // ä¸‹è½½å£çº¸
        function downloadWallpaper(imageUrl, title) {
            try {
                const link = document.createElement('a');
                link.href = imageUrl;
                link.download = `${title.replace(/[^\w\s-]/g, '')}.jpg`;
                link.target = '_blank';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateStatus(`ğŸ’¾ å¼€å§‹ä¸‹è½½: ${title}`);
            } catch (error) {
                updateStatus(`âŒ ä¸‹è½½å¤±è´¥: ${error.message}`);
            }
        }

        // é¢„è§ˆå£çº¸
        function previewWallpaper(imageUrl, title) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%; position: relative;">
                    <img src="${imageUrl}" alt="${title}" style="max-width: 100%; max-height: 100%; border-radius: 10px;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: -10px; right: -10px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 20px;">Ã—</button>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
            updateStatus(`ğŸ‘ï¸ é¢„è§ˆ: ${title}`);
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus("ğŸ¨ å…ƒæ°”å£çº¸ ForwardWidget æ¼”ç¤ºé¡µé¢å·²åŠ è½½");
            updateStatus("ğŸ’¡ è¿™æ˜¯ç¬¦åˆForwardWidgetæ ‡å‡†æ ¼å¼çš„è„šæœ¬æ¼”ç¤º");
            updateStatus("ğŸ“± æ”¯æŒå¯¼å…¥åˆ°ForwardWidgetåº”ç”¨ä¸­ä½¿ç”¨");
            updateStatus("ğŸ› ï¸ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å„é¡¹åŠŸèƒ½");
            
            // æ˜¾ç¤ºç»„ä»¶ä¿¡æ¯
            if (typeof WidgetMetadata !== 'undefined') {
                updateStatus(`âœ… ç»„ä»¶å·²åŠ è½½: ${WidgetMetadata.title} v${WidgetMetadata.version}`);
            } else {
                updateStatus("âŒ è­¦å‘Š: æœªæ£€æµ‹åˆ°WidgetMetadataå¯¹è±¡");
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey || event.metaKey) {
                switch (event.key) {
                    case '1':
                        event.preventDefault();
                        testRandomWallpapers();
                        break;
                    case '2':
                        event.preventDefault();
                        testCategoryWallpapers();
                        break;
                    case '3':
                        event.preventDefault();
                        testSearchWallpapers();
                        break;
                    case 'i':
                        event.preventDefault();
                        showWidgetMetadata();
                        break;
                }
            }
        });

        // æ˜¾ç¤ºå¿«æ·é”®æç¤º
        setTimeout(() => {
            updateStatus("âŒ¨ï¸ å¿«æ·é”®æç¤º:");
            updateStatus("   Ctrl+1: æµ‹è¯•éšæœºå£çº¸");
            updateStatus("   Ctrl+2: æµ‹è¯•åˆ†ç±»å£çº¸");
            updateStatus("   Ctrl+3: æµ‹è¯•æœç´¢å£çº¸");
            updateStatus("   Ctrl+I: æŸ¥çœ‹ç»„ä»¶ä¿¡æ¯");
        }, 1000);
    </script>
</body>
</html>